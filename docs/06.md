# Phase 6: 完整部署指南

## 快速开始

### 前置要求
- Docker Desktop (已启用 Kubernetes)
- kubectl 已安装

### 一键部署
```bash
# 进入项目目录
cd /path/to/infra

# 部署所有组件
kubectl apply -k k8s/overlays/docker-desktop/

# 等待 Pod 启动
kubectl get pods -w
```

## 验证部署

### 检查状态
```bash
# 查看所有资源
kubectl get all

# 查看服务
kubectl get svc

# 查看 Ingress
kubectl get ingress
```

### 预期结果
```
NAME                        READY   STATUS    RESTARTS   AGE
chatapp-xxx-xxx             1/1     Running   0          Xm
chatapp-xxx-xxx             1/1     Running   0          Xm
chatapp-xxx-xxx             1/1     Running   0          Xm
headlamp-xxx-xxx            1/1     Running   0          Xm
postgres-0                  1/1     Running   0          Xm
redis-0                     1/1     Running   0          Xm
```

## 访问服务

### 主要服务
- **ChatApp**: `http://localhost:30080/`
- **Headlamp**: `http://localhost:30080/headlamp/`

### 测试访问
```bash
# 测试 ChatApp
curl -I -H "Host: localhost" http://192.168.1.128:30080/

# 测试 Headlamp
curl -I -H "Host: localhost" http://192.168.1.128:30080/headlamp/
```

## 故障排除

### 常见问题
```bash
# Pod 启动失败
kubectl describe pod <pod-name>
kubectl logs <pod-name>

# 服务无法访问
kubectl get svc
kubectl get ingress

# 检查 Ingress 控制器
kubectl get pods -n ingress-nginx
```

## 清理部署

### 完全清理
```bash
# 删除所有资源
kubectl delete -k k8s/overlays/docker-desktop/

# 验证清理
kubectl get all
```

## 重新部署

### 更新配置
```bash
# 重新应用配置
kubectl apply -k k8s/overlays/docker-desktop/

# 或强制重新创建
kubectl delete -k k8s/overlays/docker-desktop/
kubectl apply -k k8s/overlays/docker-desktop/
```

## 监控

### 查看资源使用
```bash
# Pod 资源使用
kubectl top pods

# 查看日志
kubectl logs -l app=chatapp --tail=100
kubectl logs -l app=headlamp --tail=100
```

## 总结

部署完成后，您将拥有：
- ✅ **ChatApp**: Next.js 聊天应用
- ✅ **Headlamp**: Kubernetes Web UI
- ✅ **PostgreSQL**: 数据库服务
- ✅ **Redis**: 缓存服务
- ✅ **Ingress**: 流量管理

所有组件都已测试验证，可以正常访问和使用。