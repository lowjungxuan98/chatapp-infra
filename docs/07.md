# VPC 部署检查清单

## 从本地部署迁移到 VPC 部署的更改

### 1. 存储配置
**文件**: `infra/k8s/base/storage/persistent-volumes.yaml`
- 更改节点主机名: `ubuntu-linux-2404` → `chatapp`

### 2. Ingress 配置
**文件**: `infra/k8s/base/app/ingress.yaml`
- 移除 host 限制: 注释掉 `host: localhost`
- 允许通过 IP 访问

**文件**: `infra/k8s/base/headlamp/ingress.yaml`
- 移除 host 限制: 注释掉 `host: localhost`
- 允许通过 IP 访问

### 3. 服务配置
**文件**: `infra/k8s/base/ingress-nginx/svc-nodeport-patch.yaml`
- 服务类型: `NodePort` → `LoadBalancer`
- 添加 `externalIPs: [104.248.152.166]`
- 移除 `nodePort` 配置

### 4. 防火墙
```bash
sudo ufw allow 80
sudo ufw allow 443
```

### 5. 系统配置
```bash
# 启用 IP 转发
echo 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

## 访问地址
- **应用**: `http://104.248.152.166/`
- **管理界面**: `http://104.248.152.166/headlamp`

## 验证
```bash
kubectl get svc -n ingress-nginx
kubectl get ingress
curl http://104.248.152.166/
```
